# Руководство по деплою GlobalLearningHub на Vercel

Это руководство описывает процесс развертывания проекта GlobalLearningHub на платформе Vercel.

## Предварительные требования

1. Учетная запись на [Vercel](https://vercel.com)
2. Установленный [Node.js](https://nodejs.org/) (v20.x или выше)
3. Доступ к репозиторию проекта
4. Ключ API для OpenAI
5. База данных PostgreSQL (Neon)

## Шаги по деплою

### 1. Подготовка проекта

Проект уже настроен для деплоя на Vercel с соответствующими конфигурационными файлами:
- `vercel.json` - содержит настройки для платформы Vercel
- В `package.json` определены скрипты сборки
- Созданы необходимые адаптеры для Serverless Functions

### 2. Настройка базы данных

1. Создайте базу данных PostgreSQL через выбранный сервис (Neon, Supabase и т.д.)
2. Сохраните строку подключения - она понадобится для настройки переменных окружения

### 3. Деплой через Vercel CLI

**Метод 1: Использование Vercel CLI**

1. Установите Vercel CLI:
   ```bash
   npm install -g vercel
   ```

2. Войдите в свою учетную запись:
   ```bash
   vercel login
   ```

3. Перейдите в директорию проекта и выполните:
   ```bash
   vercel
   ```

4. Следуйте интерактивным инструкциям, указывая:
   - Директорию проекта (обычно текущая)
   - Организацию/аккаунт
   - Имя проекта (или используйте предложенное)
   - Папку сборки (должна быть `dist/public`)
   - Переопределите команду сборки на `npm run build`, если потребуется
   - Настройте переменные окружения (см. следующий раздел)

**Метод 2: Деплой через Git**

1. Подключите свой GitHub/GitLab репозиторий в панели управления Vercel
2. Выберите репозиторий с проектом
3. Настройте параметры сборки:
   - Framework Preset: `Other`
   - Build Command: `npm run build`
   - Output Directory: `dist/public`
4. Добавьте переменные окружения (см. следующий раздел)
5. Нажмите "Deploy"

### 4. Настройка переменных окружения

В процессе деплоя необходимо настроить следующие переменные окружения:

| Имя переменной | Описание | Пример значения |
|----------------|----------|----------------|
| `DATABASE_URL` | Строка подключения к PostgreSQL | `postgresql://user:password@neon.tech/db` |
| `OPENAI_API_KEY` | Ключ API для OpenAI | `sk-...` |
| `BLOB_READ_WRITE_TOKEN` | Токен для Vercel Blob Storage | `vercel_blob_rw_...` |

### 5. Миграция базы данных

После первого деплоя необходимо выполнить миграцию базы данных:

1. Через панель управления Vercel откройте консоль:
   - Перейдите в свой проект
   - Выберите вкладку "Deployments"
   - Нажмите на последний деплой
   - Выберите "Functions Console"

2. Выполните команду:
   ```bash
   npm run db:push
   ```

### 6. Настройка домена (опционально)

1. В панели управления Vercel перейдите на вкладку "Domains"
2. Добавьте пользовательский домен, следуя инструкциям

## Проверка деплоя

После успешного деплоя:

1. Откройте URL проекта (предоставленный Vercel)
2. Проверьте доступность frontend-части
3. Протестируйте API-эндпоинты (например, `/api/courses`)
4. Убедитесь, что взаимодействие с базой данных работает корректно

## Устранение неполадок

### Проблема: Ошибки 404 при обращении к API

**Решение**: Проверьте правильность конфигурации путей в `vercel.json`. Должны быть настроены правильные правила перенаправления для API.

### Проблема: Ошибки при взаимодействии с базой данных

**Решение**: 
1. Проверьте, правильно ли указана переменная окружения `DATABASE_URL`
2. Убедитесь, что выполнена миграция базы данных
3. Проверьте, что IP-адрес Vercel разрешен в настройках базы данных

### Проблема: Ошибки при обращении к OpenAI API

**Решение**: Проверьте правильность ключа API и наличие достаточного баланса в аккаунте OpenAI.

## Дополнительные рекомендации

1. **Мониторинг**: Настройте Vercel Analytics для отслеживания производительности
2. **Логирование**: Используйте структурированное логирование для облегчения отладки
3. **Кэширование**: Настройте кэширование статических ресурсов для улучшения производительности
4. **CI/CD**: Настройте автоматический деплой при пуше в основную ветку

## Полезные ссылки

- [Документация Vercel](https://vercel.com/docs)
- [Работа с Serverless Functions](https://vercel.com/docs/functions)
- [Vercel Blob Storage](https://vercel.com/docs/storage/vercel-blob)
- [Vercel PostgreSQL](https://vercel.com/docs/storage/vercel-postgres) 