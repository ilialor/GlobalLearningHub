# План настройки Vercel для проекта GlobalLearningHub

## Текущие проблемы

Конфигурация Vercel в проекте в настоящее время некорректна, что приводит. Основные проблемы:

1. Несоответствие путей в конфигурации `vercel.json` с реальной структурой проекта
2. Отсутствие правильной настройки для обработки серверной части (API)
3. Несогласованность между скриптами сборки в `package.json` и требованиями Vercel

## План исправления

### 1. Обновление файла vercel.json

Текущий файл `vercel.json` нужно обновить в соответствии с актуальными требованиями Vercel и структурой проекта:

```json
{
  "buildCommand": "npm run build",
  "outputDirectory": "dist/public",
  "framework": "vite",
  "rewrites": [
    { "source": "/api/(.*)", "destination": "/api/index" },
    { "source": "/(.*)", "destination": "/" }
  ]
}
```

### 2. Корректировка скриптов сборки в package.json

Текущий скрипт сборки: 
```
"build": "vite build && esbuild server/index.ts --platform=node --packages=external --bundle --format=esm --outdir=api"
```

Этот скрипт в целом правильный, но важно убедиться, что:
1. Клиентская часть собирается в директорию `dist/public`
2. Серверная часть собирается в директорию `api` с файлом `index.js` (или `index.mjs` для ESM)

### 3. Создание адаптера для Vercel Serverless Functions

В корне проекта создать файл `api/index.js` для адаптации Express-приложения к Vercel Serverless Functions:

```javascript
import app from '../server/index.js';

export default app;
```

### 4. Настройка точки входа для серверной части

Убедиться, что `server/index.ts` экспортирует Express-приложение совместимым с Vercel образом:

```typescript
// В конце server/index.ts должно быть:
export default app;
```

### 5. Конфигурация переменных окружения

Добавить необходимые переменные окружения в проект Vercel через веб-интерфейс или CLI:

1. `OPENAI_API_KEY` - для взаимодействия с OpenAI
2. Переменные доступа к базе данных (если используется)
3. Другие секреты и конфигурационные параметры из `.env`

### 6. Настройка базы данных

Если проект использует PostgreSQL:

1. Создать базу данных (например, используя Neon, Supabase или другой PostgreSQL провайдер)
2. Обновить переменные окружения в Vercel с новыми параметрами подключения
3. Запустить миграции БД при первом деплое

### 7. Проверка процесса сборки

1. Запустить сборку локально: `npm run build`
2. Проверить структуру собранного проекта:
   - `dist/public/` должна содержать клиентские файлы
   - `api/index.js` должен быть сгенерирован

### 8. Процесс деплоя на Vercel

1. Установить Vercel CLI: `npm i -g vercel`
2. Логин: `vercel login`
3. Первоначальный деплой: `vercel`
4. Настройка CI/CD:
   - Связать GitHub репозиторий с проектом Vercel
   - Настроить автоматический деплой при пуше в main/master

## Дополнительные рекомендации

### 1. Оптимизация серверного кода для Serverless

Serverless функции имеют определенные ограничения:
- Ограниченное время выполнения (обычно до 10 секунд)
- Ограничения на размер бандла (до 50 МБ)
- Cold start (холодный старт)

Рекомендации:
- Разделить большие API-эндпоинты на несколько функций
- Оптимизировать размер зависимостей
- Использовать кэширование где возможно

### 2. Статические активы и оптимизация

- Использовать Vercel Edge Network для кэширования статических ресурсов
- Настроить правильные заголовки кэширования
- Оптимизировать изображения через Vercel Image Optimization

### 3. Мониторинг и логирование

- Настроить интеграцию с сервисом мониторинга
- Добавить структурированное логирование
- Настроить алерты на ошибки

## Заключение

После выполнения этих шагов проект должен быть корректно настроен для работы на платформе Vercel. 
Ошибка 404 должна быть устранена, так как пути будут корректно настроены для обработки как клиентских, 
так и серверных запросов.
